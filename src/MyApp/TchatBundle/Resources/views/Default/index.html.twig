<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Collapsible Chat Widget - Bootsnipp.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset('bundles/myapptchat/css/style.css') }}"/>
    <link rel="stylesheet" type="text/css" media="screen"
          href="{{ asset('bundles/myapptchat/css/bootstrapmin.css') }}"/>

    <script src="{{ asset('bundles/myapptchat/js/jqueryajax.min.js') }}" type="text/javascript"></script>


</head>
<body>
<div class=" ">
    <div class="row">
        <div class="col-md-5" style="    left: 420px;    top: 150px;    width: 400px;    position: absolute;">
            <div class="panel panel-primary">
                <div class="panel-heading" id="accordion">
                    <span class="glyphicon glyphicon-comment"></span> Chat
                    <div class="btn-group pull-right">
                        <a type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="#accordion"
                           href="http://bootsnipp.com/iframe/9njj#collapseOne">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                </div>
                <div class="panel-collapse collapse in" id="collapseOne">
                    <div class="panel-body">
                        <ul class="chat">

                            {% for messages in messages %}
                                {% if messages.user.id == app.user.id %}

                                    <li class="left clearfix"> {# current user#}
                                        <span class="chat-img pull-left">
                                                    <img src="{{ asset('bundles/myapptchat/images/M.png') }}"
                                                         alt="User Avatar" class="img-circle">
                                                </span>

                                        <div class="chat-body clearfix" id="{{ messages.id }}">
                                            <div class="header">
                                                <strong class="primary-font">{{ messages.user.username }}</strong>
                                                <small class="pull-right text-muted">
                                                    <span class="glyphicon glyphicon-time"></span>{{ time_diff(messages.datecreation) }}
                                                </small>
                                            </div>
                                            <p>
                                                {{ messages.texte }}
                                            </p>
                                        </div>
                                    </li>

                                {% else %}
                                    <li class="right clearfix">    {# other user#}
                                        <span class="chat-img pull-right">
                                                    <img src="{{ asset('bundles/myapptchat/images/U.png') }}"
                                                         alt="User Avatar" class="img-circle">
                                                </span>
                                        <div class="chat-body clearfix" id="{{ messages.id }}">
                                            <div class="header">
                                                <small class=" text-muted"><span
                                                            class="glyphicon glyphicon-time"></span>
                                                    {{ time_diff(messages.datecreation) }}
                                                </small>
                                                <strong class="pull-right primary-font">{{ messages.user.username }}</strong>
                                            </div>
                                            <p>
                                                {{ messages.texte }}
                                            </p>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="panel-footer">
                        {{ form_start(form, { 'attr': { 'id':'form_submit'} } ) }}
                        <div class="input-group">
                            <!-- <input id="btn-input" type="text" class="form-control input-sm"   placeholder="Type your message here...">-->
                            <div id="inputid"> {{ form_widget(form.texte, { 'attr': { 'class':'form-control input-sm','id':'btn-input','placeholder':'Type your message here...'} } ) }}   </div>
                                    <span class="input-group-btn">
                                        <button class="btn btn-warning btn-sm" id="btn-chat" type="submit">
                                            Send
                                        </button>
                                    </span> {{ form_widget(form._token) }}
                        </div>
                        {{ form_end(form) }}
                        <script type="text/javascript">
                            $(function () {
                                $("#form_submit").submit(function (e) {
                                    e.preventDefault(); // Le navigateur ne peut pas envoyer le formulaire
                                    $.ajax({
                                        type: 'post',
                                        url: "{{path('my_app_tchat_homepage') }}",
                                        data: $(this).serialize(),
                                        datatype: "json",
                                        cache: false,
                                        success: function (data) {
                                            $('#form_submit')[0].reset();
                                        }
                                    });
                                    return false;
                                });
                            });
                        </script>
                        <script type="text/javascript">
                            $("div#inputid").click(function () {
                                $.ajax({
                                    type: 'post',
                                    url: "{{path('my_app_tchat_makevu') }}",
                                    data: $(this).serialize(),
                                    datatype: "json",
                                    cache: false,
                                    success: function (data) {
                                        // $('div.panel-body').html(data);
                                    }
                                });
                            });
                        </script>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                var refreshId = setInterval(function () {
                                    $.ajax({
                                        type: 'post',
                                        url: "{{path('my_app_tchat_show') }}",
                                        data: $(this).serialize(),
                                        datatype: "json",
                                        cache: false,
                                        success: function (data) {
                                            $('div.panel-body').html(data);
                                        }
                                    });

                                }, 2000);      /// 10 s entre deux ajax call
                            });
                        </script>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


</body>
</html>

<!-- pour les ajax call FOSJSrouting Bundle -->
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
<!-- pour les ajax call FOSJSrouting Bundle -->